version: 1.0

runtime: python311

build:
  commands:
    build:
      - echo "[build] Building app"

run:
  runtime-version: 3.11
  pre-run:
    - echo "[build] Building app"
    - echo "[build] Installing pip"
    - pip3 install --upgrade pip
    - echo "[build] Installing poetry"
    - pip3 install "poetry==2.2.1"
    - echo "[build] Configuring poetry"
    - poetry config virtualenvs.create false
    - echo "[build] Installing app deps"
    - poetry install --no-root --no-ansi
    - echo "[build] App deps installed"
  command: poetry run uvicorn api.main:app --host 0.0.0.0 --port ${PORT:-8000}
  network:
    port: 8000
    env: PORT

